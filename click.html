<!DOCTYPE html>
<html>

<head>
    <title>click</title>
    <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.2/firebase-database.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyA5osoHw4DfeD-2XtyM9ept1WKU8B_n-y0",
        authDomain: "click-449ef.firebaseapp.com",
        databaseURL: "https://click-449ef.firebaseio.com",
        projectId: "click-449ef",
        storageBucket: "click-449ef.appspot.com",
        messagingSenderId: "850612758425"
    };
    firebase.initializeApp(config);
    </script>
</head>

<body onLoad="draw()">
    <canvas id="canvas" style="background-color:#FFFFFF;" width="500" height="500" border=1px>
    </canvas>
    <script type="text/javascript">
    var canvas;
    var lightArr = [
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0]
    ];

    function update() {
        for (var i = 0; i < 5; i++) {
            for (var j = 0; j < 5; j++) {
                lightArr[i][j]--;
                if (lightArr[i][j] < 0)
                    lightArr[i][j] = 0;
            }
        }
    }

    function draw() {
        canvas = document.getElementById('canvas');
        //Ãè»­¥³¥ó¥Æ¥­¥¹¥È¤ÎÈ¡µÃ
        if (!canvas.getContext)
            return;
        var context = canvas.getContext('2d');
        context.strokeStyle = 'rgb(0, 0, 0)';

        for (var i = 0; i < 5; i++) {
            for (var j = 0; j < 5; j++) {
                context.fillStyle = 'rgb(255,' + (255 - lightArr[j][i]) + ',' + (255 - lightArr[j][i]) + ')';
                context.strokeRect(i * 100, j * 100, 100, 100);
                context.fillRect(i * 100 + 1, j * 100 + 1, 98, 98);
            }
        }
        context.strokeRect(1, 1, 498, 498);

    }


    function onClick(e) {
        var rect = e.target.getBoundingClientRect();
        var x = Math.floor((e.clientX - rect.left) / 100);
        var y = Math.floor((e.clientY - rect.top) / 100);
        lightArr[y][x] = 255;
        if (y - 1 >= 0) {
            lightArr[y - 1][x] += 100;
            if (lightArr[y - 1][x] > 255)
                lightArr[y - 1][x] = 255;
        }
        if (y + 1 < 5) {
            lightArr[y + 1][x] += 100;
            if (lightArr[y + 1][x] > 255)
                lightArr[y + 1][x] = 255;
        }
        if (x - 1 >= 0) {
            lightArr[y][x - 1] += 100;
            if (lightArr[y][x - 1] > 255)
                lightArr[y][x - 1] = 255;
        }
        if (x + 1 < 5) {
            lightArr[y][x + 1] += 100;
            if (lightArr[y][x + 1] > 255)
                lightArr[y][x + 1] = 255;
        }
        firebase.database().ref().set(lightArr);
        draw();
    }

    window.addEventListener('load', function() {
        canvas = document.getElementById('canvas');
        canvas.addEventListener('click', onClick);
    })
    setInterval(update, 10);
    setInterval(draw, 10);

    var serverRef = firebase.database().ref();
    serverRef.on('value', function(data) {
        //console.log(data.val());
        lightArr = data.val();
    });
    </script>
</body>

</html>